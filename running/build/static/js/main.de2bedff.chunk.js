(this.webpackJsonprunning=this.webpackJsonprunning||[]).push([[0],{184:function(e,t,a){e.exports=a(334)},189:function(e,t,a){},190:function(e,t,a){},210:function(e,t){},212:function(e,t){},226:function(e,t){},228:function(e,t){},256:function(e,t){},258:function(e,t){},259:function(e,t){},264:function(e,t){},266:function(e,t){},273:function(e,t){},275:function(e,t){},293:function(e,t){},295:function(e,t){},307:function(e,t){},310:function(e,t){},334:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(47),o=a.n(l),c=(a(189),a(183)),s=a(18),i=a(19),u=a(21),m=a(20),d=(a(190),a(27)),h=a(9),p=a(36),g=a.n(p),f=a(174),E=a(343),b=a(342),v=a(341);var y=function(e){var t=e.user,a=e.login,n=e.logout;return r.a.createElement(b.a,{bg:"dark",expand:"lg",variant:"dark"},r.a.createElement(b.a.Brand,{href:"/"},"Shop that orders dont work :/"),r.a.createElement(b.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(b.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(v.a,{className:"mr-auto"},r.a.createElement(d.b,{className:"nav-link",to:"/"},"Home"),r.a.createElement(d.b,{className:"nav-link",to:"/cart"},"Cart"),r.a.createElement(d.b,{className:"nav-link",to:"/order"},"Order")),r.a.createElement(v.a,null,t?r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a.Link,{href:"#user"},t.firstname," ",t.lastname),r.a.createElement(d.b,{to:"/auth/logout",onClick:n,className:"nav-link"},"Logout")):r.a.createElement(r.a.Fragment,null,r.a.createElement(d.b,{to:"/login",onClick:a,className:"nav-link"},"Login"),r.a.createElement(d.b,{to:"/register",className:"nav-link"},"Register")))))},k=a(336),C=a(337),O=a(338),S=a(181),j=a(344),w=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.fetchItems()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(k.a,null,r.a.createElement("h1",null,"Home"),r.a.createElement(C.a,{className:"m-3",onClick:function(){return e.setFilterCategory("Vegetable")}},"Vegetable"),r.a.createElement(C.a,{className:"m-3",onClick:function(){return e.setFilterCategory("Fruit")}},"Fruit")),r.a.createElement(O.a,{fluid:!0},r.a.createElement(k.a,null,this.props.items.map((function(t){return r.a.createElement(S.a,{key:t._id,md:"4",className:"mb-3"},r.a.createElement(j.a,null,r.a.createElement(j.a.Img,{variant:"top",src:t.picture,alt:t.name}),r.a.createElement(j.a.Body,null,r.a.createElement("div",null,r.a.createElement("h2",null,t.name),r.a.createElement("div",null,"Description: ",t.description," "),r.a.createElement("div",null,"Quantity: ",t.quantity),r.a.createElement("div",null,"Price: ",t.price," "),r.a.createElement(C.a,{className:"d-flex justify-content-center align-self-center",onClick:function(){return e.props.addItem(t)},id:t._id},"Add to Cart")))))})))))}}]),a}(n.Component),H=a(57),I=a.n(H),N=a(100),x=a(48),P=a(35);function q(e){var t=Object(n.useState)(!1),a=Object(x.a)(t,2),l=a[0],o=a[1],c=Object(n.useState)(null),s=Object(x.a)(c,2),i=s[0],u=s[1],m=Object(n.useState)(""),d=Object(x.a)(m,2),h=d[0],p=d[1],g=Object(n.useState)(!0),f=Object(x.a)(g,2),E=f[0],b=f[1],v=Object(n.useState)(""),y=Object(x.a)(v,2),k=y[0],C=y[1],O=Object(P.useStripe)(),S=Object(P.useElements)();Object(n.useEffect)((function(){window.fetch("".concat("https://sei23ecommerce.herokuapp.com/api","/cart/create-payment-intent"),{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":localStorage.token},body:JSON.stringify({items:e.cart,total:e.total})}).then((function(e){return e.json()})).then((function(e){C(e.clientSecret)}))}),[e.cart,e.total]);var j=function(){var e=Object(N.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b(t.empty),u(t.error?t.error.message:"");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var t=Object(N.a)(I.a.mark((function t(a){var n;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),p(!0),t.next=4,O.confirmCardPayment(k,{payment_method:{card:S.getElement(P.CardElement)}});case 4:(n=t.sent).error?(u("Payment failed ".concat(n.error.message)),p(!1)):(u(null),p(!1),o(!0),e.paidStatus(!0));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement("form",{id:"payment-form",onSubmit:w},r.a.createElement(P.CardElement,{id:"card-element",options:{style:{base:{color:"#32325d",fontFamily:"Arial, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}},onChange:j}),r.a.createElement("button",{disabled:h||E||l,id:"submit"},r.a.createElement("span",{id:"button-text"},h?r.a.createElement("div",{className:"spinner",id:"spinner"}):"Pay")),i&&r.a.createElement("div",{className:"card-error",role:"alert"},i),r.a.createElement("p",{className:l?"result-message":"result-message hidden"},"Payment succeeded, see the result in your",r.a.createElement("a",{href:"https://dashboard.stripe.com/test/payments"},"Stripe dashboard.")," Refresh the page to pay again."))}var A=a(182),F=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).promise=Object(A.a)("pk_test_51HL1OqENKFvZ9SFaQQVR6NKs2Rk2NkqKq2TJYwtUZDmD8qklZ1qBZuVfqg6OaqSPsaEK3bj1EzTOTWHSWYhYlbTy00SXjTC7NJ"),e.state={isCheckouted:!1},e.isCheckouthandler=function(){e.setState((function(e){return{isCheckouted:!e.isCheckouted}}))},e.isPaidHandler=function(t){t&&e.props.submitCart(e.props.cart)},e.submitCart=function(t){e.props.submitCart(t),console.log(t)},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.fetchItems()}},{key:"render",value:function(){var e;return console.log("this is cart.jsx",this.props.cart),this.props.cart.items.length>0&&(e=this.props.cart.items.map((function(e){return e.item.price*e.quantity})).reduce((function(e,t){return e+t}))),r.a.createElement("div",null,r.a.createElement("h1",null,"Cart"),r.a.createElement(O.a,{fluid:!0},this.props.cart.items.map((function(e){return r.a.createElement(k.a,{key:"item._id",className:"mb-3"},r.a.createElement(j.a,null,r.a.createElement(j.a.Img,{variant:"top",src:e.item.picture,style:{height:"50%",width:"50%"}}),r.a.createElement(j.a.Body,null,r.a.createElement("div",null,r.a.createElement("span",null," ",e.item.name),r.a.createElement("span",null,"Price: ",e.item.price),r.a.createElement("span",null,"Quantity: ",e.quantity),r.a.createElement("span",null,"Total price: ",e.item.price*e.quantity)))))})),r.a.createElement("h2",null,"Total: ",e||""),r.a.createElement(C.a,{onClick:this.isCheckouthandler},"Checkout Stripe"),this.state.isCheckouted&&r.a.createElement(P.Elements,{stripe:this.promise},r.a.createElement(q,{paidStatus:this.isPaidHandler,cart:this.props.cart,total:e,paymentStatus:this.state.paymentStatus}))))}}]),a}(n.Component),T=a(339),D=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return console.log("this is order.jsx",this.props.orders),r.a.createElement(O.a,{fluid:!0},r.a.createElement("h1",null,"Orders"),r.a.createElement(T.a,null,this.props.orders.map((function(e,t){return r.a.createElement(r.a.Fragment,{key:t},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Order : ",t+1)),r.a.createElement("tr",null,r.a.createElement("th",null,"Items"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Quantity"))),r.a.createElement("tbody",null,e.items.map((function(e,t){return r.a.createElement("tr",{key:t},r.a.createElement("td",null,e.item.name),r.a.createElement("td",null,e.item.price),r.a.createElement("td",null,e.quantity))})),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"3"},"Order total: ",e.items.map((function(e){return e.item.price*e.quantity})).reduce((function(e,t){return e+t}))))))}))))}}]),a}(n.Component),L=a(71),M=a(340),_=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={firstname:"",lastname:"",age:"",address:"",phone:"",password:""},e.changeHandler=function(t){e.setState(Object(L.a)({},t.target.name,t.target.value))},e.registerHandler=function(){e.props.register(e.state)},e}return Object(i.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h1",null,"Register"),r.a.createElement("div",null,r.a.createElement(O.a,null,r.a.createElement(k.a,null,r.a.createElement(M.a.Control,{name:"firstname",type:"firstname",placeholder:"firstname",onChange:this.changeHandler})),r.a.createElement(k.a,null,r.a.createElement(M.a.Control,{name:"lastname",type:"lastname",placeholder:"lastname",onChange:this.changeHandler})),r.a.createElement(k.a,null,r.a.createElement(M.a.Control,{name:"age",type:"age",placeholder:"age",onChange:this.changeHandler})),r.a.createElement(k.a,null,r.a.createElement(M.a.Control,{name:"address",type:"address",placeholder:"address",onChange:this.changeHandler})),r.a.createElement(k.a,null,r.a.createElement(M.a.Control,{name:"phone",type:"phone",placeholder:"phone",onChange:this.changeHandler})),r.a.createElement(k.a,null,r.a.createElement(M.a.Control,{name:"password",type:"password",placeholder:"password",onChange:this.changeHandler})),r.a.createElement(C.a,{variant:"primary",block:!0,onClick:this.registerHandler},"Register"))))}}]),a}(n.Component),B=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={phone:"",password:""},e.changeHandler=function(t){e.setState(Object(L.a)({},t.target.name,t.target.value))},e.loginHandler=function(){console.log(e.state),e.props.login(e.state)},e}return Object(i.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h1",null,"Login"),r.a.createElement("div",null,r.a.createElement(O.a,null,r.a.createElement(k.a,null,r.a.createElement(M.a.Control,{name:"phone",placeholder:"Phone Number",type:"phone",onChange:this.changeHandler})),r.a.createElement(k.a,null,r.a.createElement(M.a.Control,{name:"password",placeholder:"password",type:"password",onChange:this.changeHandler})),r.a.createElement(C.a,{variant:"primary",block:!0,onClick:this.loginHandler},"Login"))))}}]),a}(n.Component),R="https://sei23ecommerce.herokuapp.com/api",J=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).mounted=!0,e.state={items:[],cart:{items:[]},paymentStatus:!1,orders:[],errorMessage:null,isAuth:!1,user:null},e.logoutHandeler=function(t){t.preventDefault(),console.log("i logged out"),e.setState({items:[],cart:{items:[]},orders:[],errorMessage:null,isAuth:!1,user:null}),localStorage.removeItem("token")},e.getUserProfile=function(t){g.a.get("".concat(R,"/auth/user"),{headers:{"x-auth-token":t}}).then((function(t){console.log("from user data: ",t.data),e.setState({isAuth:!0,user:t.data.user})})).catch((function(e){console.log(e)}))},e.loginHandler=function(t){console.log(t),g.a.post("".concat(R,"/auth/login"),t).then((function(t){console.log("Logged in"),console.log(t.data),localStorage.setItem("token",t.data.token),e.getUserProfile(t.data.token)})).catch((function(t){console.log("not Logged in"),console.log(t.response.data),console.log(t),e.setState({isAuth:!1,errorMessage:t.response.data.message})}))},e.registerHandler=function(t){console.log(t),g.a.post("".concat(R,"/auth/register"),t).then((function(t){console.log(t.data),localStorage.setItem("token",t.data.token),e.setState({isAuth:!0})})).catch((function(t){console.log(t),console.log(t.res),e.setState({isAuth:!1})}))},e.addItem=function(t){var a=localStorage.getItem("token");a?g.a.post("".concat(R,"/cart/").concat(t._id,"/add"),{},{headers:{"x-auth-token":a}}).then((function(t){console.log("response: ",t),e.setState({cart:t.data.cart})})).catch((function(e){console.log(e)})):console.log("no token added")},e.fetchItems=function(){var t=localStorage.getItem("token");g.a.get("".concat(R,"/items"),{headers:{"x-auth-token":t}}).then((function(t){console.log("FETCHED",t.data),e.setState({items:t.data.items?t.data.items:[]}),e.setState({cart:t.data.cart?t.data.cart:{items:[]}}),e.setState({orders:t.data.orders?t.data.orders:[]})})).catch((function(e){console.log(e)}))},e.submitCart=function(t){console.log(t);var a=localStorage.getItem("token");e.setState({paymentStatus:!0}),g.a.post("".concat(R,"/cart/checkout"),t,{headers:{"x-auth-token":a}}).then((function(t){console.log(t.data.order),e.setState({orders:[].concat(Object(c.a)(e.state.orders),[t.data.order]),cart:{items:[]}})})).catch((function(e){console.log(e)}))},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=localStorage.getItem("token");null!=e&&(Object(f.decode)(e)?this.getUserProfile(e):localStorage.removeItem("token"))}},{key:"render",value:function(){var e=this,t=this.state,a=t.isAuth,n=t.user,l=t.errorMessage;return console.log("current state:",this.state),r.a.createElement("div",null,r.a.createElement(d.a,null,r.a.createElement(y,{user:n,logout:this.logoutHandeler,login:this.loginHandler}),l&&r.a.createElement(E.a,null,l),r.a.createElement(h.d,null,r.a.createElement(h.b,{path:"/",exact:!0,render:function(){return r.a.createElement(w,{items:e.state.items,cart:e.state.cart,addItem:e.addItem,fetchItems:e.fetchItems})}}),r.a.createElement(h.b,{exact:!0,path:"/cart",render:function(){return r.a.createElement(F,{cart:e.state.cart,fetchItems:e.fetchItems,submitCart:e.submitCart,paymentStatus:e.state.paymentStatus})}}),r.a.createElement(h.b,{exact:!0,path:"/order",render:function(){return r.a.createElement(D,{orders:e.state.orders})}}),r.a.createElement(h.b,{path:"/register",exact:!0,render:function(){return a?r.a.createElement(h.a,{to:"/"}):r.a.createElement(_,{register:e.registerHandler})}}),r.a.createElement(h.b,{path:"/login",exact:!0,render:function(){return a?r.a.createElement(h.a,{to:"/"}):r.a.createElement(B,{login:e.loginHandler})}}))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(333);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(J,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[184,1,2]]]);
//# sourceMappingURL=main.de2bedff.chunk.js.map